<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Manajemen Barang</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDZghMOYeTPRqsJuQ6dklddKL5KC-2NexA",
      authDomain: "stok-gudang-7d7bd.firebaseapp.com",
      databaseURL: "https://stok-gudang-7d7bd-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "stok-gudang-7d7bd",
      storageBucket: "stok-gudang-7d7bd.firebasestorage.app",
      messagingSenderId: "231635974096",
      appId: "1:231635974096:web:a04d725aca41b6eeb4abd5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    onAuthStateChanged(auth, user => {
      if (!user) {
        alert("Silakan login terlebih dahulu");
        window.location.href = "index.html";
      }
    });

    window.keluar = () => signOut(auth).then(() => window.location.href = "index.html");

    window.tambahBarang = () => {
      const nama = document.getElementById("nama").value.trim();
      const kategori = document.getElementById("kategori").value.trim();
      const stok = parseInt(document.getElementById("stok").value);

      if (!nama || !kategori || isNaN(stok)) return alert("Lengkapi semua field!");

      const barangRef = ref(db, "barang");
      const newBarangRef = push(barangRef);
      set(newBarangRef, { nama, kategori, stok });

      document.getElementById("form").reset();
    };

    const tampilkanBarang = () => {
      const listRef = ref(db, "barang");
      onValue(listRef, snapshot => {
        const data = snapshot.val();
        const tbody = document.getElementById("daftar-barang");
        tbody.innerHTML = "";

        if (data) {
          Object.entries(data).forEach(([id, barang]) => {
            const tr = document.createElement("tr");
            tr.classList.add("hover:bg-gray-100", "transition");
            tr.innerHTML = `
              <td class="px-4 py-2">${barang.nama}</td>
              <td class="px-4 py-2">${barang.kategori}</td>
              <td class="px-4 py-2 text-center">${barang.stok}</td>
              <td class="px-4 py-2 text-center">
                <button onclick="hapusBarang('${id}')" class="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-1 rounded shadow">
                  Hapus
                </button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        }
      });
    };
    tampilkanBarang();

    window.hapusBarang = (id) => {
      if (confirm("Yakin ingin menghapus barang ini?")) {
        const itemRef = ref(db, `barang/${id}`);
        remove(itemRef);
      }
    };
  </script>
</head>
<body class="flex bg-gray-100 min-h-screen font-sans">

  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-md min-h-screen p-6 space-y-4">
    <h1 class="text-2xl font-bold text-blue-600 mb-6">ğŸ“¦ Stok Gudang</h1>
    <nav class="space-y-2">
      <a href="dashboard.html" class="block px-4 py-2 rounded hover:bg-blue-100">ğŸ  Dashboard</a>
      <a href="barang.html" class="block px-4 py-2 rounded bg-blue-100 text-blue-800 font-semibold">ğŸ“‹ Manajemen Barang</a>
      <a href="#" onclick="keluar()" class="block px-4 py-2 rounded hover:bg-red-100 text-red-600">ğŸšª Logout</a>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="flex-1 p-8">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl font-semibold mb-6">ğŸ“‹ Data Barang</h2>

      <section class="bg-white p-6 rounded shadow mb-8">
        <h3 class="text-xl font-medium mb-4">Tambah Barang Baru</h3>
        <form id="form" onsubmit="event.preventDefault(); tambahBarang();" class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input id="nama" type="text" placeholder="Nama Barang" class="border p-2 rounded" />
          <input id="kategori" type="text" placeholder="Kategori" class="border p-2 rounded" />
          <input id="stok" type="number" placeholder="Stok" class="border p-2 rounded" />
          <div class="md:col-span-3">
            <button type="submit" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
              Tambah Barang
            </button>
          </div>
        </form>
      </section>

      <section class="bg-white p-6 rounded shadow">
        <h3 class="text-xl font-medium mb-4">Daftar Barang</h3>
        <div class="overflow-auto">
          <table class="w-full border text-sm text-left">
            <thead class="bg-blue-100">
              <tr>
                <th class="px-4 py-2">Nama</th>
                <th class="px-4 py-2">Kategori</th>
                <th class="px-4 py-2 text-center">Stok</th>
                <th class="px-4 py-2 text-center">Aksi</th>
              </tr>
            </thead>
            <tbody id="daftar-barang" class="bg-white divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

</body>
</html>